---
import Head from "@components/_head.astro"
import Footer from "@components/dashboard/_footer.astro"
import Topbar from "@components/dashboard/_topbar.astro"
import Sidenav from "@components/dashboard/_sidenav.astro"
import Scripts from "@components/_scripts.astro"

const title = "ALPHA | Dashboard"
const path = "../../dist"
const mainPage = "dashboard"
const page = "index";

const pathname = Astro.url.pathname;
const pathSegments = pathname.split('/').filter(segment => segment !== '');
const depth = pathSegments.length > 0 ? pathSegments.length - 1 : 0;
const deploymentPath = depth === 0 ? './' : '../'.repeat(depth);
---

<!doctype html>
<html lang="en">
  <head>
    <Head title={title} path={path} />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/css/jsvectormap.min.css" />
  </head>
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
      <Topbar path={path} />
      <Sidenav path={path} mainPage={mainPage} page={page} />

      <main class="app-main">
        <!-- Header -->
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-6"><h3 class="mb-0">Dashboard</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                </ol>
              </div>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="app-content">
          <div class="container-fluid">
            <!-- Small Boxes -->
            <div class="row text-center">
              <!-- CRM -->
              <div class="col-lg-4 col-12">
                <div class="small-box text-bg-info d-flex flex-column justify-content-center align-items-center py-4">
                  <i class="bi bi-people-fill fs-2 mb-2"></i>
                  <p class="fs-4 mb-0">CRM</p>
                </div>
              </div>

              <!-- LOAN -->
              <div class="col-lg-4 col-12">
                <div class="small-box text-bg-warning d-flex flex-column justify-content-center align-items-center py-4">
                  <i class="bi bi-cash-stack fs-2 mb-2"></i>
                  <p class="fs-4 mb-0">LOAN</p>
                </div>
              </div>

              <!-- STOCK -->
              <div class="col-lg-4 col-12">
                <div class="small-box text-bg-success d-flex flex-column justify-content-center align-items-center py-4">
                  <i class="bi bi-box-seam fs-2 mb-2"></i>
                  <p class="fs-4 mb-0">STOCK</p>
                </div>
              </div>
            </div>


            <!-- Main Row -->
            <div class="row">
              <!-- Direct Chat -->

              <!-- Branch Map & KPIs -->
              <div class="col-lg-5 connectedSortable">
                <div class="card text-white bg-primary bg-gradient border-primary mb-4">
                  <div class="card-header border-0">
                    <h3 class="card-title">Branch KPIs Overview</h3>
                    <div class="card-tools">
                      <button type="button" class="btn btn-primary btn-sm" data-lte-toggle="card-collapse">
                        <i data-lte-icon="expand" class="bi bi-plus-lg"></i>
                        <i data-lte-icon="collapse" class="bi bi-dash-lg"></i>
                      </button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div id="branch-map" style="height: 220px"></div>
                  </div>
                  <div class="card-footer border-0">
                    <div class="row">
                      <div class="col-4 text-center">
                        <div id="sparkline-clients" class="text-dark"></div>
                        <div class="text-white">Client Growth</div>
                        <div class="text-white">Loan Activity</div>
                        <div class="text-white">Stock</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div> <!-- /.row (main row) -->
          </div>
        </div>
      </main>
      <Footer />
    </div>

    <Scripts path={path} />

    <!-- OPTIONAL SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script is:inline>
      new Sortable(document.querySelector('.connectedSortable'), {
        group: 'shared',
        handle: '.card-header'
      })
      document.querySelectorAll('.connectedSortable .card-header').forEach(h => h.style.cursor = 'move')
    </script>

    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.min.js"></script>
    <script is:inline>
      // Loans vs Stock Orders chart
      const loan_stock_chart = new ApexCharts(
        document.querySelector('#revenue-chart'),
        {
          series: [
            { name: 'Loans', data: [12, 19, 25, 30, 28, 35, 40] },
            { name: 'Stock Orders', data: [20, 15, 18, 22, 25, 27, 30] }
          ],
          chart: { height: 300, type: 'area', toolbar: { show: false } },
          colors: ['#ffc107', '#20c997'],
          stroke: { curve: 'smooth' },
          xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'] }
        }
      )
      loan_stock_chart.render()

      // Sparklines
      const sparklineClients = new ApexCharts(document.querySelector('#sparkline-clients'), {
        series: [{ data: [100, 120, 150, 170, 200] }],
        chart: { type: 'area', height: 50, sparkline: { enabled: true } },
        colors: ['#DCE6EC']
      })
      sparklineClients.render()

      const sparklineLoans = new ApexCharts(document.querySelector('#sparkline-loans'), {
        series: [{ data: [30, 35, 40, 45, 50] }],
        chart: { type: 'area', height: 50, sparkline: { enabled: true } },
        colors: ['#DCE6EC']
      })
      sparklineLoans.render()

      const sparklineStock = new ApexCharts(document.querySelector('#sparkline-stock'), {
        series: [{ data: [200, 180, 220, 210, 230] }],
        chart: { type: 'area', height: 50, sparkline: { enabled: true } },
        colors: ['#DCE6EC']
      })
      sparklineStock.render()
    </script>

    <!-- jsVectorMap -->
    <script src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/js/jsvectormap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/maps/world.js"></script>
    <script is:inline>
      new jsVectorMap({
        selector: '#branch-map',
        map: 'world'
      })
    </script>
  </body>
</html>
